@using DevExtreme.AspNet.Mvc
@{
    ViewBag.Title = "title";
    Layout = "../Shared/_AdminLayout.cshtml";
}


@(Html.DevExtreme().DataGrid()
    .Columns(columns =>
    {
        columns.Add()
            .DataField("MaSv")
            .Caption("Mã SV");
        columns.Add()
            .DataField("HoDem")
            .Caption("Họ Đệm");
        columns.Add()
            .DataField("Ten")
            .Caption("Tên");
        columns.Add()
            .DataField("LopHocId")
            .Caption("Lớp")
            .Lookup(lookup => lookup
                .DataSource(d => d.WebApi().Controller("SinhVienApi").LoadAction("GetLop").Key("Id"))
                .DataSourceOptions(x=>x.Filter("1"))
                .DisplayExpr("Ten")
                .ValueExpr("Id")
            );
        columns.Add()
            .DataField("KhoaId")
            .Caption("Khoa")
            .Lookup(lookup => lookup
                .DataSource(d => d.WebApi().Controller("SinhVienApi").LoadAction("GetKhoa").Key("Id"))
                .DisplayExpr("TenKhoa")
                .ValueExpr("Id")
            );
        columns.Add()
            .Caption("Ngày Sinh")
            .DataField("NgaySinh")
            .DataType(GridColumnDataType.Date);
        columns.Add()
            .DataField("HoKhau")
            .Caption("Hộ Khẩu")
            .Visible(false);
        columns.Add()
            .DataField("QuocTich")
            .Caption("Quốc Tịch")
            .Visible(false);
        columns.Add()
            .DataField("DiaChi")
            .Caption("Địa Chỉ")
            .Visible(false);
        columns.Add()
            .DataField("NoiSinh")
            .Caption("Nơi Sinh")
            .Visible(false);
        columns.Add()
            .DataField("DanToc")
            .Caption("Dân Tộc")
            .Visible(false);
        columns.Add()
            .DataField("DienThoai")
            .Caption("Điện Thoại")
            .Visible(false);
        columns.Add()
            .DataField("Email")
            .ValidationRules(rules =>
            {
                rules.AddEmail().Message("Email sai định dạng");
            })
            .Visible(false);
        columns.Add()
            .DataField("Cmnd")
            .Caption("Số CMND")
            .Visible(false);
        columns.Add()
            .DataField("NgayCap")
            .Caption("Ngày Cấp")
            .DataType(GridColumnDataType.Date)
            .Visible(false);
        columns.Add()
            .DataField("NoiCap")
            .Caption("Nơi Cấp")
            .Visible(false);
        columns.Add()
            .DataField("HoTenCha")
            .Caption("Họ Tên Cha")
            .Visible(false);
        columns.Add()
            .DataField("DienThoaiCha")
            .Caption("Điện Thoại Cha")
            .Visible(false);
        columns.Add()
            .DataField("HoTenMe")
            .Caption("Họ Tên Mẹ")
            .Visible(false);
        columns.Add()
            .DataField("DienThoaiMe")
            .Caption("Điện Thoại Mẹ")
            .Visible(false);
        columns.Add()
            .DataField("GioiTinh")
            .Caption("Giới Tính")
            .Visible(false);
        columns.Add()
            .DataField("Deleted")
            .Caption("Trạng Thái")
            .Visible(false);
    })
        .Paging(paging => paging.PageSize(2))
    .Pager(pager =>
    {
        pager.ShowPageSizeSelector(true);
        pager.AllowedPageSizes(new List<int> { 2, 4, 6 });
        pager.ShowInfo(true);
    })
    .DataSource(d => d.WebApi().Controller("SinhVienApi").Key("Id"))
    .FilterRow(f => f.Visible(false))
    .GroupPanel(p => p.Visible(false))
    .Scrolling(s => s.Mode(GridScrollingMode.Virtual))
    .ShowBorders(true)
    .Editing(editing =>
    {
        editing.Mode(GridEditMode.Form);
        editing.AllowUpdating(true);
        editing.AllowAdding(true);
        editing.AllowDeleting(true);
    })
    .RemoteOperations(true)
    .AllowColumnReordering(true)
    .AllowColumnResizing(true)
    .ColumnAutoWidth(true)
    .ColumnChooser(c => c.Enabled(true))
    .ColumnFixing(c => c.Enabled(true))

)

@*<button class="btn btn-primary" style="margin-bottom: 10px" onclick="addNew()"><i class="fa fa-plus" style="margin-right: 10px"></i>Thêm mới</button>
<table style="width: 100%" id="sinhvien-table" class="table table-striped table-bordered table-hover dataTable no-footer" role="grid" aria-describedby="dynamic-table_info">
    <thead>
        <tr role="row">
            <th class="sorting" tabindex="0" aria-controls="dynamic-table" rowspan="1" colspan="1">STT</th>
            <th class="sorting" tabindex="0" aria-controls="dynamic-table" rowspan="1" colspan="1">Mã Sinh Viên</th>
            <th class="sorting" tabindex="0" aria-controls="dynamic-table" rowspan="1" colspan="1">Họ Đệm</th>
            <th class="sorting" tabindex="0" aria-controls="dynamic-table" rowspan="1" colspan="1">Tên</th>
            <th class="hidden-480 sorting" tabindex="0" aria-controls="dynamic-table" rowspan="1" colspan="1">Lớp</th>
            <th class="hidden-480 sorting" tabindex="0" aria-controls="dynamic-table" rowspan="1" colspan="1">Khoa</th>
            <th class="sorting_disabled" rowspan="1" colspan="1" aria-label="" style="width: 150px;">
                Thao tác
            </th>
        </tr>
    </thead>

    <tbody></tbody>
</table>
@section scripts{
    <script>
    $(document).ready(function() {
        function initDataTable(selector) {
            var tableConfig = Global.Config.DatatableConfig;
            tableConfig.searching = true,
            tableConfig.pageLength = 10,
            tableConfig.processing = true;
            tableConfig.serverSide = true;
            tableConfig.info = true;
            tableConfig.stateSave = false;
            tableConfig.ajaxSource = 'SinhVien/GetList';
            tableConfig.bDestroy = true;
            tableConfig.fnCreatedRow = function (row, data, index) {
                $('td', row).eq(0).html(index + 1);
            },
                tableConfig.fnServerData = function (sSource, aoData, fnCallback) {

                    $.ajax({
                        "dataType": 'json',
                        "contentType": "application/json; charset=utf-8",
                        "type": "GET",
                        "url": sSource,
                        "data": aoData,
                        "success": function (data) {
                            fnCallback(data);
                        }
                    });
                }
            tableConfig.columns = [
                {
                    "data": null,
                    "orderable": false
                },
                {
                    "data": "MaSv",
                    "orderable": false
                },
                {
                    "data": "HoDem",
                    "orderable": false
                },
                {
                    "data": "Ten",
                    "orderable": false
                },
                  {
                      "data": "TenLop",
                      "orderable": false
                  },
                    {
                        "data": "TenKhoa",
                        "orderable": false
                    },
                {
                    "data": "Id",
                    "orderable": false,
                    "render": function (id) {
                        var result =
                            '<div class="hidden-sm hidden-xs action-buttons" style="text-align: center">' +
                               '<a class="dark" onclick="getQrCode(this)" id="' + id + '" href="' +
                                id + '"><i class="ace-icon fa fa-qrcode bigger-130"></i></a>' +
                                '<a class="blue" href="Artifact/Detail/' +
                                id +
                                '"><i class="ace-icon fa fa-search-plus bigger-130"></i></a>' +
                                '<a class="green" href="Artifact/Update/' +
                                id +
                                '"><i class="ace-icon fa fa-pencil bigger-130"></i></a>' +
                                '<a class="red" onclick="deleted()" href="Artifact/Delete/' +
                                id +
                                '"><i class="ace-icon fa fa-trash-o bigger-130"></i></a></div>' +
                                '<div class="hidden-md hidden-lg"><div class="inline pos-rel">' +
                                '<button class="btn btn-minier btn-yellow dropdown-toggle" data-toggle="dropdown" data-position="auto">' +
                                '<i class="ace-icon fa fa-caret-down icon-only bigger-120"></i></button>' +
                                '<ul class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">' +
                                '<li><a class="dark" onclick="getQrCode(this)" href="' +
                                id + '"><i class="ace-icon fa fa-qrcode bigger-130"></i></a></li>' +
                                '<li><a href="Artifact/Detail/' +
                                id +
                                '" class="tooltip-info" data-rel="tooltip" title="View"><span class="blue"><i class="ace-icon fa fa-search-plus bigger-120"></i></span></a></li>' +
                                '<li><a href="Artifact/Update/' +
                                id +
                                '" class="tooltip-success" data-rel="tooltip" title="Update"><span class="green"><i class="ace-icon fa fa-pencil-square-o bigger-120"></i></span></a></li>' +
                                '<li><a href="Artifact/Delete/' +
                                id +
                                '" class="tooltip-error" onclick="deleted()" data-rel="tooltip" title="Delete"><span class="red"><i class="ace-icon fa fa-trash-o bigger-120"></i></span></a></li>' +
                                '</ul></div></div>';
                        return result;
                    }
                }
            ];
            return $('#' + selector).dataTable(tableConfig).fn;


        }

        initDataTable("sinhvien-table");
    });
</script>
}*@